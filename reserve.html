<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Reserve a batch of fresh backyard eggs. Easy online reservation form.">
    <meta name="keywords" content="reserve eggs, order eggs, fresh eggs, backyard eggs">
    <title>Reserve a Batch - Backyard Eggs</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Stylesheet -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="site-title">Backyard Eggs</a>
            <button class="mobile-nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
                ‚ò∞
            </button>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="meet-the-flockers.html">Meet The Flockers</a></li>
                <li><a href="chicken-fax.html">Chicken Fax</a></li>
                <li><a href="batches.html">Batches</a></li>
                <li><a href="reserve.html" class="active">Reserve</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="content-section">
            <h1>Reserve a Batch! ü•ö</h1>
            <p>Fill out the form below to reserve your fresh eggs. We'll get back to you as soon as possible!</p>

            <!-- Reservation Form -->
            <div id="formMessage" style="display: none; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;"></div>

            <form id="reservationForm">
                <div class="form-group">
                    <label for="name">Name *</label>
                    <input type="text" id="name" name="name" required>
                </div>

                <div class="form-group">
                    <label for="email">Email *</label>
                    <input type="email" id="email" name="email" required>
                </div>

                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" name="phone" placeholder="(773) 555-1234">
                </div>

                <div class="form-group">
                    <label for="quantity">Number of Cartons *</label>
                    <input type="number" id="quantity" name="quantity" min="1" max="10" value="1" required>
                </div>

                <div class="form-group">
                    <label for="batch">Preferred Batch (optional)</label>
                    <select id="batch" name="batch">
                        <option value="">No preference</option>
                        <option value="batch-01">Batch #01</option>
                        <option value="batch-02">Batch #02</option>
                        <option value="next-available">Next available</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="pickupDate">Preferred Pickup Date</label>
                    <input type="text" id="pickupDate" name="pickupDate" placeholder="e.g., This weekend, Tuesday, Next week">
                </div>

                <div class="form-group">
                    <label for="message">Additional Notes or Questions</label>
                    <textarea id="message" name="message" placeholder="Any special requests or questions?"></textarea>
                </div>

                <button type="submit" id="submitBtn">Submit Reservation</button>
            </form>

            <div class="payment-box" style="margin-top: 2rem;">
                <h3>After Submitting</h3>
                <p>Once we receive your reservation, we'll confirm availability and coordinate pickup details.</p>
                <p><strong>Payment:</strong> You can pay at pickup using cash, Zelle (773) 672-9100, or Venmo (@Eddie_Correa95).</p>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2026 Backyard Eggs - Fresh from Our Flock to Your Table</p>
        <p>Made with ‚ù§Ô∏è for happy chickens and egg lovers</p>
    </footer>

    <script src="js/scripts.js"></script>
    <script>
        const SUBMITTED_KEY = 'reservation_submitted';

        function showAlreadySubmitted() {
            document.getElementById('reservationForm').style.display = 'none';
            const msg = document.getElementById('formMessage');
            msg.style.display = 'block';
            msg.style.background = '#d4edda';
            msg.style.color = '#155724';
            msg.innerHTML = `
                <strong>‚úÖ You're already on the list!</strong><br>
                You've already submitted a reservation this session. We'll be in touch soon to confirm pickup details.
                If you need to make changes, please contact us directly.
            `;
        }

        // On load: check if already submitted this session
        document.addEventListener('DOMContentLoaded', () => {
            if (sessionStorage.getItem(SUBMITTED_KEY)) {
                showAlreadySubmitted();
            }
        });

        document.getElementById('reservationForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const formMessage = document.getElementById('formMessage');
            const originalText = submitBtn.textContent;

            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            formMessage.style.display = 'none';

            try {
                const formData = {
                    name: document.getElementById('name').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    quantity: document.getElementById('quantity').value,
                    batch: document.getElementById('batch').value,
                    pickupDate: document.getElementById('pickupDate').value,
                    message: document.getElementById('message').value
                };

                const response = await fetch('/.netlify/functions/submit-reservation', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok) {
                    // Mark submitted for this session and hide the form
                    sessionStorage.setItem(SUBMITTED_KEY, '1');

                    formMessage.style.display = 'block';
                    formMessage.style.background = '#d4edda';
                    formMessage.style.color = '#155724';
                    formMessage.innerHTML = `
                        <strong>‚úÖ Reservation Submitted!</strong><br>
                        Thank you, ${formData.name}! We've received your reservation for ${formData.quantity} carton(s).<br>
                        We'll contact you at ${formData.email} to confirm availability and pickup details.
                    `;

                    document.getElementById('reservationForm').style.display = 'none';

                    // Scroll to message
                    formMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    throw new Error(result.error || 'Failed to submit');
                }
            } catch (error) {
                formMessage.style.display = 'block';
                formMessage.style.background = '#f8d7da';
                formMessage.style.color = '#721c24';
                formMessage.innerHTML = `
                    <strong>‚ùå Submission Failed</strong><br>
                    ${error.message}<br>
                    Please try again or contact us directly.
                `;

                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
